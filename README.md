# NetworkProject

هدف از انجام این پروژه پیاده سازی ساختار یک DNS  پروکسی با استفاده از socket است.
Parse_dns_packet :
در این متود با استفاده از پکتی که دریافت میکند بخش header  را جدا میکند(12 بیت اول پکت).بعد از آن با استفاده از یک  حلقه نام domain مورد نظر که در چکت وجود دارد را پیدا میکند. بعد از نام domain 4 پکت بعدی شامل تایپ و کلاس Query است و در آخر این متود داده های بدست آمده را بازمیگرداند.

Change_rcode:
Header شامل فرمت خاصی است که از بخش های مختلف تشکیل شده است (qr,rcode,aa,tc,…) .
در این متود با تغییر rcode  به عددی غیر صفر(1) نشان میدهیم که پکت ارسالی با ارور همراه بوده است .

Change_id:
این متود دو پکت یکی شامل دیتا و دیگر شامل پکت دریافتی از DNS server است، سپس جای id دیتای دریافتی با id پکتی دریافتی عوض میشود تا پس از ارسال مجدد به مشکل همراه نشود.

Db-select:
ابتدا تمام key ها موجود ذخیره میشوند. در این متود مقادیری که به هر key اختصاص داده شده بود در دیتا بیس به cache اضافه میشوند و cache به عنوان خروجی این متود برگردانده میشود
Db_insert:
در این متود پس از وصل شدن به سرور ردیس کلید را با زمان و پکت مپ میکنیم و در ردیس ذخیره میکنیم.

Dns:
بخش اصلی کد که منطق برنامه در آن پیاده سازی شده است.
ابتدا یه socket ساخته میشود که به ip_dns_server وصل میشود. سپس دیتایی که وارد شده بود پارس میشود (توسط متود parse_dns_packet ).همانطور  که گفته شد خروجی های متفاوتی دارد و در درایه 1 آن نام دامین قرار دارد. سپس چک میشود که آیا تایپ دیتای دریافتی A یا AAAA هست یا نه و اگر نبود rcode تغییر کرده و ارور برمیگرداند.
پس از چک شدن شرط شرط دیگری وجود دارد که نگاه میکند آیا در cache موجود است یا نه و آیا از زمانی که باید ذخیره شده باشد گذشته یا نه اگر در کش موجود بود دیتا سریعا برگردانده میشود در غیر اینصورت باید به dns server دیتا را فرستاده و نتیجه یا همان response را دریافت کنیم. اگر در header نتیجه rcode مخالف 0 بود یعنی با ارور همراه بودیم که در اینصورت باید dns server  های بعدی رو هم که درفایل setting.json قرار دارند چک کنیم اگر صفر بود response در cache ذخیره میشود. و در اخر response به کاربر فرستاده میشود.

Socket s برای ارتباط بین کاربر و DNS proxy است.
